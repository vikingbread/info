<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="DownloadDo">
    <typeAlias alias="downloadDo" type="com.jiankong.admin.domain.DownloadDo"/>
	<resultMap id="download_result" class="downloadDo">
		<result property="id" column="id" jdbcType="int" />
		<result property="createAuthor" column="create_author" jdbcType="string" />
		<result property="modifyAuthor" column="modify_author" jdbcType="string" />
		<result property="title" column="title" jdbcType="String" />
		<result property="discription" column="discription" jdbcType="String" />
		<result property="feature" column="feature" jdbcType="String" />
		<result property="createGmt" column="create_gmt" jdbcType="Date" />
		<result property="modifyGmt" column="modify_gmt" jdbcType="Date" />
		<result property="url" column="url" jdbcType="String" />
		<result property="imgUrl" column="img_url" jdbcType="String" />
		<result property="viewtime" column="viewtime" jdbcType="int" />
		<result property="status" column="status" jdbcType="int" />
	</resultMap>
	
	<sql id="all_download_column">
	id,create_author,modify_author,title,discription,feature,create_gmt,modify_gmt,url,img_url,viewtime,status
	</sql>
	
	<select id="Download.getDownloadById" parameterClass="java.lang.Long" resultMap="download_result">
	select <include refid="all_download_column" /> from download where id = #id# and status = 1
	
	</select>
	
	<insert id="Download.insertDownload" parameterClass="downloadDo">
	insert into download values(null,#createAuthor#,'',#title#,#discription#,#feature#,now(),null,#url#,#imgUrl#,default,default)
		<selectKey resultClass="java.lang.Long" keyProperty="id">
		select max(id) from download
		</selectKey> 
	</insert> 
	
	<update id="Download.deleteDownload" parameterClass="java.lang.Long">
	update download set status = 0 where id = #id#
	
	</update>
	
	<update id="Download.updateDownload" parameterClass="downloadDo" >
	update download set modify_author=#modifyAuthor#,title=#title#,discription=#discription#,feature=#feature#,modify_gmt=now(),url=#url#,img_url=#imgUrl# where id=#id#
	</update>
	
	<select id="Download.getAllRecord" resultClass = "java.lang.Integer">
	select count(*) from download where status = 1 
	</select>
	
	<select id="Download.queryDownloadListByDownloadIds" resultMap="download_result">
   
   select <include refid = "all_download_column" /> from download
   where  status = 1 and
			id in 
			<iterate property="downloadIdList"  open="(" close=")"  conjunction=",">
    					#downloadIdList[]#   
	    	</iterate>
	</select>
	
	<select id="Download.queryDownloadList" resultMap="download_result">
	select <include refid = "all_download_column" /> from download where status = 1 order by id desc
	</select>
	<update id="Download.addViewTimes" parameterClass="java.lang.Long">
		update download set viewtime =viewtime+1 where id = #id#
	</update>
</sqlMap>